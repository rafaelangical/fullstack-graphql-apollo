{"version":3,"sources":["../../src/android/AndroidParser.ts"],"names":["AndroidParser","splitMessages","raw","messages","data","toString","match","timeRegex","timeHeader","slice","index","length","nextMatch","body","push","parseMessages","map","rawMessage","timeMatch","Error","headerMatch","headerRegex","priority","tag","pid","platform","date","Date","getFullYear","parseInt","trim","Priority","fromLetter","reduce","acc","entry","getTime"],"mappings":"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","sourcesContent":["import { IParser, Entry } from '../types';\nimport { Priority } from './constants';\n\nexport default class AndroidParser implements IParser {\n  static timeRegex: RegExp = /(\\d{2})-(\\d{2}) (\\d{2}):(\\d{2}):(\\d{2}).\\d{3}/m;\n  static headerRegex: RegExp = /^\\s*(\\w)\\/(.+)\\(([\\s\\d]+)\\):/;\n\n  splitMessages(raw: string): string[] {\n    const messages: string[] = [];\n    let data = raw.toString();\n    let match = data.match(AndroidParser.timeRegex);\n    while (match) {\n      const timeHeader = match[0];\n      data = data.slice((match.index || 0) + timeHeader.length);\n      const nextMatch = data.match(AndroidParser.timeRegex);\n      const body = nextMatch ? data.slice(0, nextMatch.index) : data;\n      messages.push(`${timeHeader} ${body}`);\n      match = nextMatch;\n    }\n    return messages;\n  }\n\n  parseMessages(messages: string[]): Entry[] {\n    return messages\n      .map(\n        (rawMessage: string): Entry => {\n          const timeMatch = rawMessage.match(AndroidParser.timeRegex);\n          if (!timeMatch) {\n            throw new Error(\n              `Time regex was not matched in message: ${rawMessage}`\n            );\n          }\n\n          const headerMatch = rawMessage\n            .slice(timeMatch[0].length)\n            .match(AndroidParser.headerRegex) || ['', 'U', 'unknown', '-1'];\n\n          const [, priority, tag, pid] = headerMatch;\n          return {\n            platform: 'android',\n            date: new Date(\n              new Date().getFullYear(),\n              parseInt(timeMatch[1], 10) - 1,\n              parseInt(timeMatch[2], 10),\n              parseInt(timeMatch[3], 10),\n              parseInt(timeMatch[4], 10),\n              parseInt(timeMatch[5], 10)\n            ),\n            pid: parseInt(pid.trim(), 10) || 0,\n            priority: Priority.fromLetter(priority),\n            tag: tag.trim() || 'unknown',\n            messages: [\n              rawMessage\n                .slice(timeMatch[0].length + headerMatch[0].length)\n                .trim(),\n            ],\n          };\n        }\n      )\n      .reduce((acc: Entry[], entry: Entry) => {\n        if (\n          acc.length > 0 &&\n          acc[acc.length - 1].date.getTime() === entry.date.getTime() &&\n          acc[acc.length - 1].tag === entry.tag &&\n          acc[acc.length - 1].pid === entry.pid &&\n          acc[acc.length - 1].priority === entry.priority\n        ) {\n          acc[acc.length - 1].messages.push(...entry.messages);\n          return acc;\n        }\n\n        return [...acc, entry];\n      }, []);\n  }\n}\n"],"file":"AndroidParser.js"}